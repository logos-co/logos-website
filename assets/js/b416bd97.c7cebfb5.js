"use strict";(self.webpackChunklogos_docs=self.webpackChunklogos_docs||[]).push([[66],{7402:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>d});var i=n(4848),l=n(8453);const o={title:"Waku Module",description:"Messaging transport powered by Waku within Logos."},r="Waku Module",t={id:"modules/waku",title:"Waku Module",description:"Messaging transport powered by Waku within Logos.",source:"@site/docs/modules/waku.md",sourceDirName:"modules",slug:"/modules/waku",permalink:"/logos-website/docs/modules/waku",draft:!1,unlisted:!1,editUrl:"https://github.com/logos-co/logos-website/edit/main/website/docs/modules/waku.md",tags:[],version:"current",frontMatter:{title:"Waku Module",description:"Messaging transport powered by Waku within Logos."},sidebar:"docs",previous:{title:"Package Manager Module",permalink:"/logos-website/docs/modules/package-manager"},next:{title:"Wallet Module",permalink:"/logos-website/docs/modules/wallet"}},c={},d=[{value:"Overview",id:"overview",level:2},{value:"API",id:"api",level:2},{value:"Methods",id:"methods",level:3},{value:"Events",id:"events",level:3},{value:"Notes",id:"notes",level:3},{value:"Examples",id:"examples",level:2},{value:"C++",id:"c",level:3},{value:"Javascript",id:"javascript",level:3}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"waku-module",children:"Waku Module"}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["The Waku Module wraps ",(0,i.jsx)(s.code,{children:"nwaku"})," via ",(0,i.jsx)(s.code,{children:"libwaku"})," and exposes functions to configure, start and interact with a Waku node. Other modules (e.g., ",(0,i.jsx)(s.code,{children:"chat"}),") use it to publish, subscribe and query messages over Waku Relay, Filter and Store."]}),"\n",(0,i.jsx)(s.h2,{id:"api",children:"API"}),"\n",(0,i.jsx)(s.h3,{id:"methods",children:"Methods"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"initWaku(cfg: string)"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Creates a Waku context using the provided JSON configuration."}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," if the context was created."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"startWaku()"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Starts the Waku node asynchronously."}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," if the start was initiated successfully."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"setEventCallback()"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Registers a callback with Waku so incoming messages are forwarded as events."}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," when the callback is set."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"relaySubscribe(pubSubTopic: string)"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Subscribes to a pub/sub topic using Waku Relay."}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," if subscription was initiated."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"relayPublish(pubSubTopic: string, jsonWakuMessage: string)"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Publishes a JSON\u2011encoded ",(0,i.jsx)(s.code,{children:"WakuMessage"})," to a pub/sub topic."]}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," if publish was initiated."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"filterSubscribe(pubSubTopic: string, contentTopics: string)"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Subscribes to messages matching specific content topics using Waku Filter."}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"contentTopics"})," is a JSON string (array) as expected by ",(0,i.jsx)(s.code,{children:"libwaku"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," if subscription was initiated."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"storeQuery(jsonQuery: string, peerAddr: string)"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Performs a Store query for historical messages."}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"jsonQuery"})," is a JSON string per ",(0,i.jsx)(s.code,{children:"libwaku"}),"'s API."]}),"\n",(0,i.jsxs)(s.li,{children:["Returns ",(0,i.jsx)(s.code,{children:"true"})," if the query was initiated."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"foo(bar: string)"})," \u2192 ",(0,i.jsx)(s.code,{children:"bool"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Test method that emits a debug event for wiring verification."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"events",children:"Events"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"wakuMessage"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Emitted when an incoming live message is received via the registered event callback."}),"\n",(0,i.jsxs)(s.li,{children:["Payload (",(0,i.jsx)(s.code,{children:"QVariantList"})," / JSON array): ",(0,i.jsx)(s.code,{children:"[messageJson: string, timestamp: string]"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"storeQueryResponse"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Emitted when a Store query completes."}),"\n",(0,i.jsxs)(s.li,{children:["Payload (",(0,i.jsx)(s.code,{children:"QVariantList"})," / JSON array): ",(0,i.jsx)(s.code,{children:"[resultJson: string, timestamp: string]"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"fooTriggered"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Emitted by ",(0,i.jsx)(s.code,{children:"foo()"})," for testing."]}),"\n",(0,i.jsxs)(s.li,{children:["Payload (",(0,i.jsx)(s.code,{children:"QVariantList"})," / JSON array): ",(0,i.jsx)(s.code,{children:"[bar: string, timestamp: string]"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Call ",(0,i.jsx)(s.code,{children:"initWaku()"})," before ",(0,i.jsx)(s.code,{children:"startWaku()"})," and event\u2011related operations."]}),"\n",(0,i.jsxs)(s.li,{children:["Use ",(0,i.jsx)(s.code,{children:"setEventCallback()"})," before expecting live ",(0,i.jsx)(s.code,{children:"wakuMessage"})," events."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"jsonWakuMessage"}),", ",(0,i.jsx)(s.code,{children:"contentTopics"}),", and ",(0,i.jsx)(s.code,{children:"jsonQuery"})," must follow ",(0,i.jsx)(s.code,{children:"libwaku"})," inputs."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(s.h3,{id:"c",children:"C++"}),"\n",(0,i.jsxs)(s.p,{children:["Using generated ",(0,i.jsx)(s.code,{children:"C++"})," wrappers from another module"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-cpp",children:'// Initialize and start Waku\nlogos.waku_module.initWaku(R"({"listenAddress":"0.0.0.0","port":60000})");\nlogos.waku_module.startWaku();\nlogos.waku_module.setEventCallback();\n\n// Subscribe to events\nlogos.waku_module.on("wakuMessage", [](const QVariantList& data) {\n    const auto json = data[0].toString();\n    const auto ts = data[1].toString();\n    qInfo() << "wakuMessage" << ts << json;\n});\n\n// Relay subscribe and publish\nlogos.waku_module.relaySubscribe("/waku/2/default-waku/proto");\nlogos.waku_module.relayPublish(\n  "/waku/2/default-waku/proto",\n  R"({"payload":"SGVsbG8gV2FrdSE=","contentTopic":"/toy-chat/2/general/proto"})"\n);\n\n// Store query\nlogos.waku_module.storeQuery(\n  R"({"contentTopics":["/toy-chat/2/general/proto"],"pageSize":10})",\n  "/ip4/127.0.0.1/tcp/15555/p2p/16Uiu2HAm..."\n);\n'})}),"\n",(0,i.jsx)(s.h3,{id:"javascript",children:"Javascript"}),"\n",(0,i.jsxs)(s.p,{children:["Using the ",(0,i.jsx)(s.code,{children:"JavaScript"})," SDK (reflective API)"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:'const LogosAPI = require(\'logos-api\');\n\nconst logos = new LogosAPI();\nlogos.start();\nlogos.processAndLoadPlugins(["waku_module"]);\nlogos.startEventProcessing();\n\n// Subscribe to events\nlogos.waku_module.onWakuMessage((evt) => {\n  console.log(\'wakuMessage:\', evt);\n});\n\n(async () => {\n  await logos.waku_module.initWaku(\'{"listenAddress":"0.0.0.0","port":60000}\');\n  await logos.waku_module.startWaku();\n  await logos.waku_module.setEventCallback();\n  await logos.waku_module.relaySubscribe(\'/waku/2/default-waku/proto\');\n  await logos.waku_module.relayPublish(\'/waku/2/default-waku/proto\', \'{"payload":"SGVsbG8=","contentTopic":"/toy-chat/2/general/proto"}\');\n  await logos.waku_module.storeQuery(\'{"contentTopics":["/toy-chat/2/general/proto"],"pageSize":5}\', \'/ip4/127.0.0.1/tcp/15555/p2p/16U...\');\n})();\n'})})]})}function u(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>t});var i=n(6540);const l={},o=i.createContext(l);function r(e){const s=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);